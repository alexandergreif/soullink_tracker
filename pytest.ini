[pytest]
minversion = 7.0
addopts = 
    --strict-markers
    --strict-config
    --cov=src
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-fail-under=90
    -v
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*
asyncio_mode = auto
markers =
    # Feature version markers
    v2_only: Run test with V2-only configuration (no event store)
    v3_only: Run test with V3-only configuration (event store enabled)
    dualwrite: Run test with V3 dual-write configuration (V2 + V3 parallel)
    
    # Test category markers
    unit: Unit tests (fast, isolated)
    integration: Integration tests (database, real components)
    e2e: End-to-end tests with Playwright (full system)
    api: API endpoint tests
    db: Database-specific tests
    ws: WebSocket tests
    
    # Performance and load markers
    slow: Slow-running tests (> 5 seconds)
    concurrency: Multi-threaded concurrency tests
    stress: High-volume stress tests (many operations)
    
    # Specialized test categories for Phase 3.4
    rebuild_race: Projection rebuild vs live update race tests
    constraint: Database constraint violation tests
    savepoint: Transaction savepoint recovery tests
    
    # Skip conditions
    skip_ci: Skip in CI environment
    manual: Manual testing only
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning